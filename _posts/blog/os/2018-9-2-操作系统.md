---
layout:     post
title:      "操作系统"
date:       2018-9-2 
header-img: "img/post-bg-3.png"
categories: Cpp，OS
---

### 操作系统

操作系统：用于管理计算机系统的硬件资源，软件资源及数据资源，控制程序运行，提供操作接口，为其他应用软件提供支持的软件系统。

基本特征：并发，共享，虚拟，异步

常用的操作系统：Unix,Linux,DOS,Windows,Mac。

------

### 进程和线程的区别：

Ⅰ 拥有资源

进程是资源分配的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源。

Ⅱ 调度

线程是独立调度的基本单位，在同一进程中，线程的切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程切换。

Ⅲ 系统开销

由于创建或撤销进程时，系统都要为之分配或回收资源，如内存空间、I/O 设备等，所付出的开销远大于创建或撤销线程时的开销。类似地，在进行进程切换时，涉及当前执行进程 CPU 环境的保存及新调度进程 CPU 环境的设置，而线程切换时只需保存和设置少量寄存器内容，开销很小。

Ⅳ 通信方面

线程间可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助 IPC（进程间的通信方式）。

------

### 进程通信与进程同步

进程同步与进程通信很容易混淆，它们的区别在于：

- 进程同步：控制多个进程按一定顺序执行；
- 进程通信：进程间传输信息。

进程通信是一种手段，而进程同步是一种目的。也可以说，为了能够达到进程同步的目的，需要让进程进行通信，传输一些进程同步所需要的信息。

### 进程间的通信方式：

#### 1. 管道

管道是通过调用 pipe 函数创建的，fd[0] 用于读，fd[1] 用于写。

它具有以下限制：

- 只支持半双工通信（单向交替传输）；
- 只能在父子进程或者兄弟进程中使用。

![](\img\Blog\os\tu1.png)

#### 2. FIFOs

也称为命名管道，去除了管道只能在父子进程中使用的限制。

FIFO 常用于客户-服务器应用程序中，FIFO 用作汇聚点，在客户进程和服务器进程之间传递数据。

![](\img\Blog\os\tu2.png)

#### 3. 消息队列

相比于 FIFO，消息队列具有以下优点：

- 消息队列可以独立于读写进程存在，从而避免了 FIFO 中同步管道的打开和关闭时可能产生的困难；
- 避免了 FIFO 的同步阻塞问题，不需要进程自己提供同步方法；
- 读进程可以根据消息类型有选择地接收消息，而不像 FIFO 那样只能默认地接收。

#### 4. 信号量

它是一个计数器，用于为多个进程提供对共享数据对象的访问。

#### 5. 共享内存

允许多个进程共享一个给定的存储区。因为数据不需要在进程之间复制，所以这是最快的一种 IPC。需要使用信号量用来同步对共享存储的访问。

#### 6. 套接字

与其它通信机制不同的是，它可用于不同机器间的进程通信。



### 线程同步的方式：

线程同步是多线程通过特定的设置来控制线程之间的执行顺序，主要由四种方式：临界区，互斥量，信号量，事件。其中临界区和互斥量主要用于互斥控制，信号量和事件主要用于同步控制。

------

### 死锁

死锁：当两个或多个进程相互持有对方所需要的资源，导致这些线程处于等待状态，无法前往执行。当线程相互持有对方所需要的资源时，会互相等待对方释放资源，如果进程都不主动释放所占有的资源，将会产生死锁。

死锁的必要条件：

- 互斥：每个资源要么已经分配给了一个进程，要么就是可用的。
- 占有和等待：已经得到了某个资源的进程可以再请求新的资源。
- 不可抢占：已经分配给一个进程的资源不能强制性地被抢占，它只能被占有它的进程显式地释放。
- 环路等待：有两个或者两个以上的进程组成一条环路，该环路中的每个进程都在等待下一个进程所占有的资源。

如何避免：

1.加锁顺序：线程要按照一定的顺序加锁；

2.加锁时限：线程尝试获取锁的时候加上一定的时限，超出时限则放弃对该锁的请求，并释放自己占有的锁。

3.死锁检测。



### 僵尸进程

一个父进程利用fork创建子进程，如果子进程退出，而父进程没有利用wait 或者  waitpid 来获取子进程的状态信息，那么子进程的状态描述符依然保存在系统中。

### 孤儿进程

一个父进程退出， 而它的一个或几个子进程仍然还在运行，那么这些子进程就会变成孤儿进程，孤儿进程将被init进程（进程号为1）所收养，并由init进程对它们完成状态收集的工作。

### 守护进程：

守护进程是指在后台运行，没有控制终端与之连接的进程。它独立于控制终端，通常周期性地执行某种任务。

------

### 分页与分段的比较

- 对程序员的透明性：分页透明，但是分段需要程序员显式划分每个段。
- 地址空间的维度：分页是一维地址空间，分段是二维的。
- 大小是否可以改变：页的大小不可变，段的大小可以动态改变。
- 出现的原因：分页主要用于实现虚拟内存，从而获得更大的地址空间；分段主要是为了使程序和数据可以被划分为逻辑上独立的地址空间并且有助于共享和保护。

